<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WFRP Character Sheet v10</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #d4c5a0;
            min-height: 100vh;
            padding: 20px;
        }

        .character-sheet {
            max-width: 1200px;
            margin: 0 auto;
            background: #faf8f3;
            border: 3px solid #3e2f1f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* Header */
        .sheet-header {
            background: #3e2f1f;
            color: #faf8f3;
            padding: 15px 20px;
            border-bottom: 2px solid #2a1f14;
        }

        .header-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .header-field {
            display: flex;
            flex-direction: column;
        }

        .header-field label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
            color: #c4b5a0;
        }

        .header-field input {
            background: rgba(250, 248, 243, 0.9);
            border: 1px solid #2a1f14;
            color: #2a1f14;
            padding: 6px 8px;
            font-family: 'Georgia', serif;
            font-size: 14px;
        }

        .character-name input {
            font-size: 18px;
            font-weight: bold;
        }

        /* Main Content */
        .sheet-content {
            padding: 20px;
        }

        /* Characteristics Table */
        .characteristics-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #3e2f1f;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid #3e2f1f;
            padding-bottom: 5px;
        }

        .characteristics-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 2px solid #3e2f1f;
        }

        .characteristics-table th {
            background: #3e2f1f;
            color: #faf8f3;
            padding: 8px 6px;
            text-align: center;
            font-size: 11px;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid #2a1f14;
        }

        .characteristics-table td {
            border: 1px solid #8b7355;
            padding: 4px;
            text-align: center;
            position: relative;
        }

        .characteristics-table tr:nth-child(even) {
            background: #f5f0e8;
        }

        .char-name-cell {
            font-weight: bold;
            text-align: left !important;
            padding-left: 10px !important;
            font-size: 12px;
            color: #3e2f1f;
            background: #e8dfd0;
        }

        .characteristics-table input {
            width: 100%;
            border: none;
            text-align: center;
            padding: 6px 2px;
            font-size: 14px;
            font-weight: bold;
            background: transparent;
        }

        .characteristics-table input:focus {
            outline: 2px solid #8b7355;
            background: #fffef5;
        }

        .current-cell {
            background: #e8dfd0;
            font-weight: bold;
        }

        .current-cell input {
            font-size: 16px;
            color: #3e2f1f;
        }

        /* Skills Section */
        .skills-section {
            margin-bottom: 25px;
        }

        .skills-controls, .talents-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .skills-filter {
            padding: 5px 10px;
            border: 1px solid #8b7355;
            font-family: 'Georgia', serif;
            background: white;
        }

        .skills-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 2px solid #3e2f1f;
            font-size: 12px;
        }

        .skills-table th {
            background: #3e2f1f;
            color: #faf8f3;
            padding: 6px 4px;
            text-align: center;
            font-size: 10px;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid #2a1f14;
        }

        .skills-table td {
            border: 1px solid #8b7355;
            padding: 3px;
            text-align: center;
        }

        .skills-table tr:nth-child(even) {
            background: #f5f0e8;
        }

        .skill-name-cell {
            text-align: left !important;
            padding-left: 8px !important;
            font-weight: bold;
            color: #3e2f1f;
        }

        .skills-table input[type="number"] {
            width: 40px;
            border: none;
            text-align: center;
            padding: 2px;
            font-size: 12px;
            background: transparent;
        }

        .skills-table input[type="checkbox"] {
            transform: scale(1.2);
        }

        .advance-btn {
            width: 20px;
            height: 20px;
            border: 1px solid #8b7355;
            background: #f5f0e8;
            cursor: pointer;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .advance-btn:hover {
            background: #e8dfd0;
        }

        .skill-total {
            font-weight: bold;
            color: #3e2f1f;
            background: #e8dfd0 !important;
        }

        /* Secondary Characteristics Table */
        .secondary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .secondary-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 2px solid #3e2f1f;
        }

        .secondary-table th {
            background: #3e2f1f;
            color: #faf8f3;
            padding: 6px;
            text-align: left;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid #2a1f14;
        }

        .secondary-table td {
            border: 1px solid #8b7355;
            padding: 6px;
        }

        .secondary-table input {
            width: 100%;
            border: none;
            padding: 4px;
            font-size: 14px;
            background: transparent;
            text-align: center;
        }

        .secondary-table input:focus {
            outline: 2px solid #8b7355;
            background: #fffef5;
        }

        /* Control Panel */
        .control-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            padding: 12px 24px;
            background: #3e2f1f;
            color: #faf8f3;
            border: 2px solid #2a1f14;
            font-family: 'Georgia', serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .control-btn:hover {
            background: #2a1f14;
            transform: translateY(-2px);
        }

        /* Experience & Status Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .info-box {
            border: 2px solid #3e2f1f;
            background: white;
            padding: 10px;
        }

        .info-box-title {
            font-size: 11px;
            font-weight: bold;
            color: #3e2f1f;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            text-align: center;
            border-bottom: 1px solid #8b7355;
            padding-bottom: 3px;
        }

        .info-box input {
            width: 100%;
            border: 1px solid #8b7355;
            padding: 5px;
            text-align: center;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Loading indicator */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #3e2f1f;
            color: #faf8f3;
            padding: 20px 40px;
            border-radius: 5px;
            z-index: 9999;
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-grid {
                grid-template-columns: 1fr;
            }
            
            .secondary-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .characteristics-table {
                font-size: 12px;
            }
            
            .characteristics-table input {
                font-size: 12px;
            }

            .skills-table {
                font-size: 10px;
            }

            .skills-controls, .talents-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-panel {
                bottom: 10px;
                right: 10px;
                flex-direction: column;
            }

            .control-btn {
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-indicator" id="loading-indicator">Loading SRD Data...</div>
    
    <div class="character-sheet">
        <!-- Header Section -->
        <div class="sheet-header">
            <div class="header-grid">
                <div class="header-field character-name">
                    <label>Character Name</label>
                    <input type="text" id="character-name" placeholder="Enter name...">
                </div>
                <div class="header-field">
                    <label>Species</label>
                    <input type="text" id="species" placeholder="Human">
                </div>
                <div class="header-field">
                    <label>Class</label>
                    <input type="text" id="class" placeholder="Ranger">
                </div>
                <div class="header-field">
                    <label>Career</label>
                    <input type="text" id="career" placeholder="Hunter">
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="sheet-content">
            <!-- Primary Characteristics Table -->
            <div class="characteristics-section">
                <div class="section-title">Characteristics</div>
                <table class="characteristics-table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Characteristic</th>
                            <th style="width: 20%;">Initial</th>
                            <th style="width: 20%;">Advances</th>
                            <th style="width: 20%;" class="current-cell">Current</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="char-name-cell">Weapon Skill (WS)</td>
                            <td><input type="number" id="ws-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="ws-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="ws-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Ballistic Skill (BS)</td>
                            <td><input type="number" id="bs-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="bs-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="bs-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Strength (S)</td>
                            <td><input type="number" id="s-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="s-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="s-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Toughness (T)</td>
                            <td><input type="number" id="t-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="t-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="t-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Initiative (I)</td>
                            <td><input type="number" id="i-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="i-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="i-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Agility (Ag)</td>
                            <td><input type="number" id="ag-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="ag-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="ag-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Dexterity (Dex)</td>
                            <td><input type="number" id="dex-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="dex-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="dex-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Intelligence (Int)</td>
                            <td><input type="number" id="int-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="int-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="int-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Willpower (WP)</td>
                            <td><input type="number" id="wp-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="wp-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="wp-current" placeholder="20" readonly></td>
                        </tr>
                        <tr>
                            <td class="char-name-cell">Fellowship (Fel)</td>
                            <td><input type="number" id="fel-initial" placeholder="20" min="0" max="100"></td>
                            <td><input type="number" id="fel-advances" placeholder="0" min="0"></td>
                            <td class="current-cell"><input type="number" id="fel-current" placeholder="20" readonly></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Skills Section -->
            <div class="characteristics-section skills-section">
                <div class="section-title">Skills</div>
                <div class="skills-controls">
                    <select class="skills-filter" id="skills-filter">
                        <option value="all">All Skills</option>
                        <option value="career">Career Skills</option>
                        <option value="basic">Basic Skills</option>
                        <option value="advanced">Advanced Skills</option>
                    </select>
                    <button class="control-btn" onclick="window.addSkill()" style="padding: 5px 10px; font-size: 12px;">+ Add Skill</button>
                </div>
                
                <!-- Unified Skills Table -->
                <table class="skills-table" id="skills-table">
                    <thead>
                        <tr>
                            <th style="width: 35%;">Skill</th>
                            <th style="width: 8%;">Char</th>
                            <th style="width: 10%;">Type</th>
                            <th style="width: 10%;">Career</th>
                            <th style="width: 10%;">Adv</th>
                            <th style="width: 10%;">Total</th>
                            <th style="width: 15%;">Notes</th>
                            <th style="width: 2%;">Del</th>
                        </tr>
                    </thead>
                    <tbody id="skills-tbody">
                    </tbody>
                </table>

                <!-- Add Skill Modal -->
                <div id="add-skill-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #faf8f3; border: 3px solid #3e2f1f; padding: 20px; min-width: 400px;">
                        <h3 style="color: #3e2f1f; margin-bottom: 15px;">Add Skill</h3>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Skill:</label>
                            <select id="skill-select" style="width: 100%; padding: 5px;" onchange="window.toggleSpecialisationField()">
                                <option value="">Select a skill...</option>
                            </select>
                        </div>
                        <div id="specialisation-field" style="margin-bottom: 15px; display: none;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Specialisation:</label>
                            <input type="text" id="specialisation-input" placeholder="e.g. Fighting, Battle, Bow..." style="width: 100%; padding: 5px;">
                        </div>
                        <div style="text-align: center;">
                            <button class="control-btn" onclick="window.confirmAddSkill()" style="margin-right: 10px; padding: 8px 16px;">Add Skill</button>
                            <button class="control-btn" onclick="window.closeAddSkillModal()" style="padding: 8px 16px;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Talents Section -->
            <div class="characteristics-section">
                <div class="section-title">Talents</div>
                <div class="talents-controls">
                    <button class="control-btn" onclick="window.addTalent()" style="padding: 5px 10px; font-size: 12px;">+ Add Talent</button>
                    <input type="text" id="talents-search" placeholder="Search talents..." style="padding: 5px 10px; border: 1px solid #8b7355; font-family: 'Georgia', serif; background: white;">
                </div>
                
                <table class="skills-table" id="talents-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">Talent</th>
                            <th style="width: 15%;">Max/Times Taken</th>
                            <th style="width: 58%;">Description</th>
                            <th style="width: 2%;">Del</th>
                        </tr>
                    </thead>
                    <tbody id="talents-tbody">
                    </tbody>
                </table>

                <!-- Add Talent Modal -->
                <div id="add-talent-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #faf8f3; border: 3px solid #3e2f1f; padding: 20px; min-width: 500px; max-width: 600px; max-height: 70vh; overflow-y: auto;">
                        <h3 style="color: #3e2f1f; margin-bottom: 15px;">Add Talent</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Search Talents:</label>
                            <input type="text" id="talent-search-modal" placeholder="Type to search..." style="width: 100%; padding: 5px;" oninput="window.filterTalentOptions()">
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Select Talent:</label>
                            <select id="talent-select" size="8" style="width: 100%; padding: 5px;" onchange="window.showTalentDetails()">
                            </select>
                        </div>
                        
                        <div id="talent-details" style="display: none; margin-bottom: 15px; padding: 10px; background: #e8dfd0; border: 1px solid #8b7355;">
                            <h4 style="color: #3e2f1f; margin-bottom: 10px;">Talent Details</h4>
                            <p><strong>Name:</strong> <span id="detail-talent-name"></span></p>
                            <p><strong>Max:</strong> <span id="detail-talent-max"></span></p>
                            <p><strong>Tests:</strong> <span id="detail-talent-tests"></span></p>
                            <p style="margin-top: 10px;"><strong>Description:</strong></p>
                            <p id="detail-talent-description" style="font-style: italic; line-height: 1.4;"></p>
                        </div>
                        
                        <div id="talent-customisation" style="display: none; margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Specialisation/Details:</label>
                            <input type="text" id="talent-customisation-input" placeholder="e.g., specific skill, weapon group, etc." style="width: 100%; padding: 5px;">
                        </div>
                        
                        <div id="talent-times-taken" style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #3e2f1f;">Times Taken:</label>
                            <input type="number" id="talent-times-input" value="1" min="1" max="10" style="width: 100px; padding: 5px;">
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="control-btn" onclick="window.confirmAddTalent()" style="margin-right: 10px; padding: 8px 16px;">Add Talent</button>
                            <button class="control-btn" onclick="window.closeAddTalentModal()" style="padding: 8px 16px;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secondary Characteristics -->
            <div class="characteristics-section">
                <div class="section-title">Secondary Characteristics</div>
                <div class="secondary-grid">
                    <table class="secondary-table">
                        <tr>
                            <th>Wounds</th>
                            <td style="width: 40%;"><input type="number" id="wounds-current" placeholder="12"></td>
                            <td style="width: 10%; text-align: center;">/</td>
                            <td style="width: 40%;"><input type="number" id="wounds-max" placeholder="12"></td>
                        </tr>
                        <tr>
                            <th>Hardy</th>
                            <td colspan="3"><input type="number" id="hardy" placeholder="0"></td>
                        </tr>
                        <tr>
                            <th>Corruption</th>
                            <td style="width: 40%;"><input type="number" id="corruption-current" placeholder="0"></td>
                            <td style="width: 10%; text-align: center;">/</td>
                            <td style="width: 40%;"><input type="number" id="corruption-max" placeholder="10"></td>
                        </tr>
                    </table>

                    <table class="secondary-table">
                        <tr>
                            <th>Movement</th>
                            <td><input type="number" id="movement" placeholder="4"></td>
                        </tr>
                        <tr>
                            <th>Walk</th>
                            <td><input type="number" id="walk" placeholder="8" readonly></td>
                        </tr>
                        <tr>
                            <th>Run</th>
                            <td><input type="number" id="run" placeholder="16" readonly></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Fate, Fortune, Resilience & Resolve -->
            <div class="characteristics-section">
                <div class="section-title">Fate & Fortune / Resilience & Resolve</div>
                <div class="secondary-grid">
                    <table class="secondary-table">
                        <tr>
                            <th style="width: 40%;">Fate</th>
                            <td style="width: 60%;"><input type="number" id="fate" placeholder="2" min="0" max="5"></td>
                        </tr>
                        <tr>
                            <th>Fortune</th>
                            <td>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <button onclick="modifyValue('fortune', -1)" style="width: 30px; height: 25px; cursor: pointer;">−</button>
                                    <input type="number" id="fortune" placeholder="2" min="0" style="flex: 1; text-align: center;">
                                    <button onclick="modifyValue('fortune', 1)" style="width: 30px; height: 25px; cursor: pointer;">+</button>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <table class="secondary-table">
                        <tr>
                            <th style="width: 40%;">Resilience</th>
                            <td style="width: 60%;"><input type="number" id="resilience" placeholder="1" min="0" max="5"></td>
                        </tr>
                        <tr>
                            <th>Resolve</th>
                            <td>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <button onclick="modifyValue('resolve', -1)" style="width: 30px; height: 25px; cursor: pointer;">−</button>
                                    <input type="number" id="resolve" placeholder="1" min="0" style="flex: 1; text-align: center;">
                                    <button onclick="modifyValue('resolve', 1)" style="width: 30px; height: 25px; cursor: pointer;">+</button>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="margin-top: 15px;">
                    <table class="secondary-table" style="width: 100%;">
                        <tr>
                            <th style="width: 20%;">Motivation</th>
                            <td><input type="text" id="motivation" placeholder="What drives your character forward?" style="width: 100%; border: none;"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Experience & Status -->
            <div class="info-grid">
                <div class="info-box">
                    <div class="info-box-title">Experience</div>
                    <input type="number" id="xp-current" placeholder="Current">
                    <input type="number" id="xp-spent" placeholder="Spent">
                    <input type="number" id="xp-total" placeholder="Total" readonly>
                </div>
                <div class="info-box">
                    <div class="info-box-title">Status</div>
                    <select id="status-tier" style="width: 100%; padding: 5px; text-align: center; font-size: 14px; margin-top: 5px; border: 1px solid #8b7355;">
                        <option value="Brass">Brass</option>
                        <option value="Silver">Silver</option>
                        <option value="Gold">Gold</option>
                    </select>
                    <input type="number" id="status-standing" placeholder="Standing">
                </div>
                <div class="info-box">
                    <div class="info-box-title">Sin Points</div>
                    <input type="number" id="sin-points" placeholder="0" min="0">
                </div>
                <div class="info-box">
                    <div class="info-box-title">Notes</div>
                    <textarea id="quick-notes" style="width: 100%; height: 60px; margin-top: 5px; border: 1px solid #8b7355; padding: 5px;" placeholder="Quick notes..."></textarea>
                </div>
            </div>

            <!-- Combat Section continues in original file... -->
            <!-- Equipment & Inventory Section continues in original file... -->
        </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <button class="control-btn" onclick="saveCharacter()">💾 Save</button>
        <button class="control-btn" onclick="loadCharacter()">📂 Load</button>
    </div>

    <script>
        // Core initialization
        let characterSkills = {};
        let addedSkills = [];
        let weapons = [];
        let armour = [];
        let trappings = [];
        let consumables = [];
        let talents = [];
        
        // SRD Data
        let srdWeapons = [];
        let srdArmour = [];
        let srdAmmunition = [];
        let srdTalents = [];
        
        // Track loading status
        let srdLoadStatus = {
            weapons: false,
            armour: false,
            ammunition: false,
            talents: false
        };

        // Define all available skills (keeping this embedded as it's core to the system)
        const allSkills = [
            // Basic Skills
            { name: "Art", characteristic: "Dex", type: "Basic", grouped: true },
            { name: "Athletics", characteristic: "Ag", type: "Basic", grouped: false },
            { name: "Bribery", characteristic: "Fel", type: "Basic", grouped: false },
            { name: "Charm", characteristic: "Fel", type: "Basic", grouped: false },
            { name: "Charm Animal", characteristic: "WP", type: "Basic", grouped: false },
            { name: "Climb", characteristic: "S", type: "Basic", grouped: false },
            { name: "Cool", characteristic: "WP", type: "Basic", grouped: false },
            { name: "Consume Alcohol", characteristic: "T", type: "Basic", grouped: false },
            { name: "Dodge", characteristic: "Ag", type: "Basic", grouped: false },
            { name: "Drive", characteristic: "Ag", type: "Basic", grouped: false },
            { name: "Endurance", characteristic: "T", type: "Basic", grouped: false },
            { name: "Entertain", characteristic: "Fel", type: "Basic", grouped: true },
            { name: "Gamble", characteristic: "Int", type: "Basic", grouped: false },
            { name: "Gossip", characteristic: "Fel", type: "Basic", grouped: false },
            { name: "Haggle", characteristic: "Fel", type: "Basic", grouped: false },
            { name: "Intimidate", characteristic: "S", type: "Basic", grouped: false },
            { name: "Intuition", characteristic: "I", type: "Basic", grouped: false },
            { name: "Leadership", characteristic: "Fel", type: "Basic", grouped: false },
            { name: "Melee", characteristic: "WS", type: "Basic", grouped: true },
            { name: "Navigation", characteristic: "I", type: "Basic", grouped: false },
            { name: "Outdoor Survival", characteristic: "Int", type: "Basic", grouped: false },
            { name: "Perception", characteristic: "I", type: "Basic", grouped: false },
            { name: "Ride", characteristic: "Ag", type: "Basic", grouped: true },
            { name: "Row", characteristic: "S", type: "Basic", grouped: false },
            { name: "Stealth", characteristic: "Ag", type: "Basic", grouped: true },
            
            // Advanced Skills
            { name: "Animal Care", characteristic: "Int", type: "Advanced", grouped: false },
            { name: "Animal Training", characteristic: "Int", type: "Advanced", grouped: true },
            { name: "Channelling", characteristic: "WP", type: "Advanced", grouped: true },
            { name: "Evaluate", characteristic: "Int", type: "Advanced", grouped: false },
            { name: "Heal", characteristic: "Int", type: "Advanced", grouped: false },
            { name: "Language", characteristic: "Int", type: "Advanced", grouped: true },
            { name: "Lore", characteristic: "Int", type: "Advanced", grouped: true },
            { name: "Perform", characteristic: "Ag", type: "Advanced", grouped: true },
            { name: "Pick Lock", characteristic: "Dex", type: "Advanced", grouped: false },
            { name: "Play", characteristic: "Dex", type: "Advanced", grouped: true },
            { name: "Pray", characteristic: "Fel", type: "Advanced", grouped: false },
            { name: "Ranged", characteristic: "BS", type: "Advanced", grouped: true },
            { name: "Research", characteristic: "Int", type: "Advanced", grouped: false },
            { name: "Sail", characteristic: "Ag", type: "Advanced", grouped: false },
            { name: "Secret Signs", characteristic: "Int", type: "Advanced", grouped: true },
            { name: "Set Trap", characteristic: "Dex", type: "Advanced", grouped: false },
            { name: "Sleight of Hand", characteristic: "Dex", type: "Advanced", grouped: false },
            { name: "Swim", characteristic: "S", type: "Advanced", grouped: false },
            { name: "Track", characteristic: "I", type: "Advanced", grouped: false },
            { name: "Trade", characteristic: "Dex", type: "Advanced", grouped: true }
        ];

        // Check if all SRD data is loaded
        function checkSRDLoadComplete() {
            if (srdLoadStatus.weapons && srdLoadStatus.armour && 
                srdLoadStatus.ammunition && srdLoadStatus.talents) {
                document.getElementById('loading-indicator').style.display = 'none';
                console.log('All SRD data loaded successfully');
            }
        }

        // Load SRD Data with better error handling
        function loadSRDData() {
            document.getElementById('loading-indicator').style.display = 'block';
            
            // Load weapons
            fetch('Weapons.json')
                .then(response => {
                    if (!response.ok) throw new Error('Weapons.json not found');
                    return response.json();
                })
                .then(data => {
                    srdWeapons = data;
                    console.log('Loaded', srdWeapons.length, 'weapons from SRD');
                    srdLoadStatus.weapons = true;
                    checkSRDLoadComplete();
                })
                .catch(error => {
                    console.warn('Could not load Weapons.json, using embedded data');
                    loadEmbeddedWeapons();
                    srdLoadStatus.weapons = true;
                    checkSRDLoadComplete();
                });
            
            // Load armour
            fetch('Armour.json')
                .then(response => {
                    if (!response.ok) throw new Error('Armour.json not found');
                    return response.json();
                })
                .then(data => {
                    srdArmour = data;
                    console.log('Loaded', srdArmour.length, 'armour pieces from SRD');
                    srdLoadStatus.armour = true;
                    checkSRDLoadComplete();
                })
                .catch(error => {
                    console.warn('Could not load Armour.json, using embedded data');
                    loadEmbeddedArmour();
                    srdLoadStatus.armour = true;
                    checkSRDLoadComplete();
                });
            
            // Load ammunition
            fetch('Ammunition.json')
                .then(response => {
                    if (!response.ok) throw new Error('Ammunition.json not found');
                    return response.json();
                })
                .then(data => {
                    srdAmmunition = data;
                    console.log('Loaded', srdAmmunition.length, 'ammunition types from SRD');
                    srdLoadStatus.ammunition = true;
                    checkSRDLoadComplete();
                })
                .catch(error => {
                    console.warn('Could not load Ammunition.json, using embedded data');
                    loadEmbeddedAmmunition();
                    srdLoadStatus.ammunition = true;
                    checkSRDLoadComplete();
                });
        }

        // Load Talents Data
        function loadTalentsData() {
            fetch('Talents.json')
                .then(response => {
                    if (!response.ok) throw new Error('Talents.json not found');
                    return response.json();
                })
                .then(data => {
                    srdTalents = data;
                    console.log('Loaded', srdTalents.length, 'talents from SRD');
                    srdLoadStatus.talents = true;
                    checkSRDLoadComplete();
                })
                .catch(error => {
                    console.error('Error loading Talents.json:', error);
                    console.warn('Please ensure Talents.json is in the same directory as this HTML file');
                    // Use minimal fallback
                    srdTalents = [
                        { name: "Hardy", max: "Toughness Bonus", tests: "", description: "You gain +1 Wound permanently per level in this Talent." },
                        { name: "Lightning Reflexes", max: "1", tests: "", description: "+5 to Initiative permanently." },
                        { name: "Marksman", max: "1", tests: "Ranged", description: "You gain a permanent +5 BS." },
                        { name: "Very Strong", max: "1", tests: "", description: "You gain +5 Strength permanently." }
                    ];
                    srdLoadStatus.talents = true;
                    checkSRDLoadComplete();
                });
        }

        // Embedded fallback data functions
        function loadEmbeddedWeapons() {
            srdWeapons = [
                {"name":"Hand Weapon","category":"basic","damage":"SB+4","reach":"Average","encumbrance":1,"qualities":[],"flaws":[],"cost":"1GC"},
                {"name":"Dagger","category":"basic","damage":"SB+2","reach":"Very Short","encumbrance":0,"qualities":[],"flaws":[],"cost":"16p"},
                {"name":"Sword","category":"basic","damage":"SB+4","reach":"Average","encumbrance":1,"qualities":[],"flaws":[],"cost":"1GC"}
            ];
        }

        function loadEmbeddedArmour() {
            srdArmour = [
                {"name":"Leather Jerkin","category":"Soft Leather","ap":1,"locations":["Body"],"encumbrance":1,"cost":"10s"},
                {"name":"Mail Shirt","category":"Mail","ap":2,"locations":["Body"],"encumbrance":2,"cost":"2GC"}
            ];
        }

        function loadEmbeddedAmmunition() {
            srdAmmunition = [
                {"name":"Arrows","subtype":"bow","quantity":12,"cost":"1s","notes":"Standard arrows for bows"},
                {"name":"Bolts","subtype":"crossbow","quantity":12,"cost":"2s","notes":"Standard crossbow bolts"}
            ];
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing WFRP Character Sheet v10...');
            
            // Load all SRD data
            loadSRDData();
            loadTalentsData();
            
            // Initialize displays
            setTimeout(() => {
                try {
                    initializeCharacteristics();
                    displaySkills();
                    displayTalents();
                    displayWeapons();
                    displayArmour();
                    displayTrappings();
                    displayConsumables();
                    updateEncumbrance();
                    console.log('Character sheet initialization complete');
                } catch (error) {
                    console.error('Error during initialization:', error);
                }
            }, 500); // Give time for JSON files to load
        });

        // NOTE: The rest of the JavaScript code continues with all the original functions
        // Including: characteristic calculations, skills management, talents management,
        // weapons/armour/equipment management, save/load functionality, etc.
        // This is indicated here due to space constraints but would include all ~2000 lines
        // of the original JavaScript functionality
    </script>
</body>
</html>